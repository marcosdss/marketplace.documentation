---
slug: release-20231011
authors: [marcola]
tags: [spike]
---

# Spike - LIONS 188

### Assinatura | Carrinhos de Compras

**1. Introdução**

Desejamos que a opção de Assinatura e suas informações estejam disponíveis na etapa do carrinho de compras. É nesta etapa que ele irá confirmar se todos os produtos selecionados nas etapas anteriores estão de acordo com o que ele deseja.  Com isso, precisamos que sejam incluídas as especificações a seguir, sempre seguindo a proposta de layout do figma.

**2. Solução**

**2.1** Podemos exibir as modificações visuais a partir de um parâmetro fornecido pelo orderForm. Dentro de **items** em **attachments**, temos **vtex.subscription**.

**3. Diretrizes para o Desenvolvimento**

**3.1 Buscar Configuração do Carrinho**

Com o **vtex.order-manager/OrderForm** conseguimos obter informações do carrinho, em **items > attachments** conseguimos informações de assinatura/anexo.

**3.2 Layout**

Como o componente será customizado, fica a critério do desenvolvedor seguir o melhor caminho desde que siga os padrões do projeto, os critérios de aceite da tarefa e considerando o Figma.

**3.3 Remover a Recorrência**

Após ter desenvolvido o layout, a frequência deve ser removida via API attachments.

Exemplo abaixo:

```bash
fetch(`/api/checkout/pub/orderForm/ORDERFORM_ID/items/ITEM_INDEX/attachments/vtex.subscription`,
  {
    method: "DELETE",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      content: { vtex.subscription.key.frequency: "1 week" },
      expectedOrderFormSections: [
        "items",
        "totalizers",
        "clientProfileData",
        "shippingData",
        "paymentData",
        "sellers",
        "messages",
        "marketingData",
        "clientPreferencesData",
        "storePreferencesData",
        "giftRegistryData",
        "ratesAndBenefitsData",
        "openTextField",
        "commercialConditionData",
        "customData",
      ],
      noSplitItem: true,
    }),
  }
)
  .then((response) => response.json())
  .then((data) => {
    console.log("Resposta Pós Attachment", data);
  })
  .catch((err) => console.error(err));
```

**3.3 Tagueamento**

No **Google Tag Manager**:

- Criar um acionador para o botão de exclusão da recorrência. Pode utilizar a classe do elemento como referência no Google Tag Manager;
- Criar um evento de clique com o acionar atrelado com nome do evento: **remove_recurrence** e **page_url** com a página do atual do usuário (/cart, neste caso);

**:memo: Links úteis:**
- [Oque é um anexo](https://help.vtex.com/pt/tutorial/o-que-e-um-anexo--aGICk0RVbqKg6GYmQcWUm) <br/>
- [Como criar um anexo de assinatura](https://help.vtex.com/pt/tutorial/como-criar-um-anexo-de-assinatura--2bUuKyPflA8cOGLv8OvaKK)
- [Google Tag Manager](https://support.google.com/tagmanager/answer/12811173?hl=en)
