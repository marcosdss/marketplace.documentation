---
slug: techinsights-22-12
title: Tech Insights - 22/12
authors: [marcola]
tags: [tech insights, developer, dev notes]
---

# Devpost - 22/12

## Duplicidade de Produtos | Overview

Ol√°, pessoal! Como est√£o? üòÑ

Esse Tech Insight √© sobre a duplicidade de produtos no processo de assinatura/recorr√™ncia, esse tema √© uma Known Issue em aberto pela VTEX.

[Products in the `product-list` that have an `itemAttachment` duplicate when the quantity is increased](https://help.vtex.com/known-issues/products-in-the-productlist-that-have-an-itemattachment-duplicate-when-the-quantity-is-increased--2rKPKD21uXZ8iSIq8wNiVf)

### Introdu√ß√£o

**1. Quando ocorre o problema ?**

O problema ocorre sempre que a quantidade do produto (produto com attachment vinculado) √© alterada. Ent√£o, imaginando que o produto tenha um attachment de assinatura vinculado a ele, sempre que alterar a quantidade o mesmo se duplica.

**2. Como reproduzir o cen√°rio ?**

Adicione um produto com assinatura ao carrinho e atribua um attachment a ele via API e tente aumentar/diminuir a quantidade.

**2.1 Produto para Teste:**

[Kit Tomate Pelado Oba Bem Querer 400 G 3 Unidades](https://www.obahortifruti.com.br/kit-tomate-pelado-oba-bem-querer-400-g-3-unidades/p)

**2.2 Anexo/Attachment:**

[vtex.subscription.teste](https://obahortifruti.myvtex.com/admin/Site/AnexoForm.aspx?Id=20)

**2.3 API:**

```bash
fetch(`/api/checkout/pub/orderForm/ORDERFORM_ID/items/ITEM_INDEX/attachments/vtex.subscription.teste`,
  {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      content: {
        "vtex.subscription.key.frequency": "1 week",
        "vtex.subscription.key.purchaseday": "0"
      },
      expectedOrderFormSections: [
        "items",
        "totalizers",
        "clientProfileData",
        "shippingData",
        "paymentData",
        "sellers",
        "messages",
        "marketingData",
        "clientPreferencesData",
        "storePreferencesData",
        "giftRegistryData",
        "ratesAndBenefitsData",
        "openTextField",
        "commercialConditionData",
        "customData",
      ],
      noSplitItem: true,
    }),
  }
)
  .then((response) => response.json())
  .then((data) => {
    console.log("Resposta P√≥s Attachment", data);
  })
  .catch((err) => console.error(err));
```

[Configuring the frequency and date of the subscription cycle](https://help.vtex.com/pt/tutorial/como-criar-um-anexo-de-assinatura--2bUuKyPflA8cOGLv8OvaKK#configuring-the-frequency-and-date-of-the-subscription-cycle)

<br/>

**2.4 Case VTEX IO com o mesmo problema em produ√ß√£o:**

[Extrafarma](https://www.extrafarma.com.br/)

**3. Quais foram as tentativas para solu√ß√£o do problema ?**

- Tentamos armazenar a informa√ß√£o de attachment localmente e inseri-la ao produto apenas no /checkout mas de qualquer forma o produto duplicaria caso o cliente retornasse a loja e modificasse a quantidade.
Nesse caso, tamb√©m perderiamos a fun√ß√£o de carrinho abandonado;
- Foi sugerido pela VTEX a mudan√ßa no parametro **noSplitItem** da **API de Attachments** mas sem sucesso;
- Remo√ß√£o completa do produto e adicionar de novo com a quantidade selecionada;
- Remo√ß√£o dos produtos duplicados;

_Qualquer customiza√ß√£o no front-end n√£o resolveria o problema j√° que ele se encontra no back-end da VTEX. Inserimos o produto, alteramos a quantidade e recebemos um retorno de carrinho duplicado diretamente das API's VTEX._

<br/>
<br/>

Qualquer d√∫vida, n√£o hesitem em perguntar. Obrigado pela colabora√ß√£o!

Equipe Lions ü¶Å

**:memo: Links √∫teis:**
- [Como funciona a recorr√™ncia](https://help.vtex.com/pt/tutorial/como-funciona-a-assinatura--frequentlyAskedQuestions_4453#como-o-cliente-da-sua-loja-visualiza-suas-assinaturas)
- [Como configurar recorr√™ncia na sua loja](https://help.vtex.com/pt/tutorial/como-configurar-assinatura-v2--1FA9dfE7vJqxBna9Nft5Sj)
- [Como criar um anexo](https://help.vtex.com/pt/tutorial/como-criar-um-anexo-de-assinatura--2bUuKyPflA8cOGLv8OvaKK?&utm_source=autocomplete)
